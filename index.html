<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <title>clubs A · Boss 战小页</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #ffffff;
      --panel: #ffffff;
      --text: #0e1220;
      --sub: #4a4f6a;
      --accent: #2f5cff;
      --danger: #e63e6d;
      --shadow: 0 16px 40px rgba(0,0,0,.10);
      --radius: 16px;
      --border: #e6e8ef;
      --name-chip: #2b3170;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans SC", "PingFang SC", "Microsoft YaHei", sans-serif;
      color: var(--text);
      background: var(--bg);
      display: flex; align-items: center; justify-content: center;
      padding: 28px;
    }
    .card {
      width: 100%;
      max-width: 1120px;
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 26px 26px 30px;
      position: relative;
      overflow: hidden;
    }

    .header {
      display: flex; align-items: center; justify-content: space-between;
      gap: 16px; margin-bottom: 18px;
    }
    .title { font-size: 28px; font-weight: 800; letter-spacing: .3px; }
    .sub { color: var(--sub); font-size: 16px; opacity: .95; margin-top: 4px; }
    .pill {
      padding: 10px 14px; border-radius: 999px; font-weight: 700;
      background: #f3f6ff;
      border: 1px solid #dfe4ff; color: #2b3170; font-size: 14px;
    }

    .boss-wrap {
      background: #ffffff;
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 14px;
      position: relative;
    }
    .boss {
      width: 100%;
      display: grid; place-items: center;
      border: 1px dashed #d6d9e6;
      border-radius: 12px;
      background: #fafbff;
      padding: 14px;
      position: relative;
      overflow: hidden;
      isolation: isolate;
    }

    /* 顶部击败横幅 */
    .banner {
      position: absolute;
      left: 50%; top: 14px;
      transform: translateX(-50%) translateY(-20px);
      background: linear-gradient(180deg, #ff6b8f, #e63e6d);
      color: #fff;
      padding: 10px 18px;
      border-radius: 999px;
      box-shadow: 0 10px 22px rgba(230,62,109,.25);
      border: 1px solid rgba(255,255,255,.32);
      font-weight: 900; letter-spacing: .6px; font-size: 16px;
      opacity: 0; pointer-events: none; z-index: 6;
    }
    .banner.show { animation: bannerIn .55s cubic-bezier(.2,.7,.2,1) forwards; }
    @keyframes bannerIn {
      0% { transform: translateX(-50%) translateY(-20px) scale(.94); opacity: 0; }
      60% { transform: translateX(-50%) translateY(0) scale(1.04); opacity: 1; }
      100% { transform: translateX(-50%) translateY(0) scale(1); opacity: 1; }
    }

    /* 800x1200 显示区域（分层：背景 + 角色） */
    .boss-frame {
      width: 800px; height: 1200px; max-width: 100%;
      aspect-ratio: 2 / 3;
      border-radius: 12px;
      overflow: hidden;
      display: grid; place-items: center;
      background: #f1f3ff;
      border: 1px solid #e3e6f3;
      position: relative;
      box-shadow:
        inset 0 10px 40px rgba(47,92,255,0.06),
        inset 0 -10px 40px rgba(230,62,109,0.05);
    }

    /* Boss 名称角标 */
    .name-chip {
      position: absolute; right: 10px; top: 10px; z-index: 7;
      background: #ffffffcc;
      backdrop-filter: blur(6px);
      color: var(--name-chip);
      border: 1px solid #dfe4ff;
      border-radius: 999px;
      padding: 6px 10px;
      font-weight: 800; letter-spacing: .4px; font-size: 12px;
      box-shadow: 0 6px 16px rgba(0,0,0,.06);
    }

    /* 背景图层（无呼吸） */
    .boss-bg {
      position: absolute; inset: 0;
      display: grid; place-items: center;
      z-index: 1;
    }
    .boss-bg img {
      width: 100%; height: 100%;
      object-fit: cover; /* 背景铺满 */
      filter: saturate(1.02) contrast(1.02);
      transform: scale(1.02);
    }

    /* 人物图层（有呼吸） */
    .boss-char {
      position: absolute; inset: 0; z-index: 3;
      display: grid; place-items: center;
    }
    .boss-char img {
      width: 100%; height: 100%;
      object-fit: contain; /* 保持比例显示人物 */
      transform-origin: 50% 55%;
      filter: drop-shadow(0 8px 22px rgba(0,0,0,.16));
      will-change: transform, filter, opacity;
      transition: opacity .45s ease;
    }

    /* 人物呼吸动画（更自然：位移+缩放+微亮度变化） */
    .boss-frame.entering .boss-char img {
      animation: bossEnter .9s cubic-bezier(.2,.8,.2,1) both, bossBreath 4.6s ease-in-out 1.1s infinite;
    }
    .boss-frame:not(.entering) .boss-char img {
      animation: bossBreath 4.6s ease-in-out infinite;
    }
    @keyframes bossEnter {
      0%   { transform: translateY(30px) scale(.86); filter: drop-shadow(0 6px 18px rgba(0,0,0,.12)) brightness(.98); opacity: 0; }
      40%  { transform: translateY(-6px) scale(1.04); opacity: 1; }
      70%  { transform: translateY(0) scale(1); }
      100% { transform: translateY(0) scale(1); filter: drop-shadow(0 8px 22px rgba(0,0,0,.16)) brightness(1); }
    }
    @keyframes bossBreath {
      0%   { transform: translateY(0px) scale(1);   filter: drop-shadow(0 8px 22px rgba(0,0,0,.16)) brightness(1); }
      25%  { transform: translateY(-6px) scale(1.012); filter: drop-shadow(0 10px 24px rgba(0,0,0,.18)) brightness(1.02); }
      50%  { transform: translateY(0px) scale(1.004); filter: drop-shadow(0 8px 22px rgba(0,0,0,.16)) brightness(1); }
      75%  { transform: translateY(6px) scale(0.996);  filter: drop-shadow(0 7px 20px rgba(0,0,0,.14)) brightness(.995); }
      100% { transform: translateY(0px) scale(1);   filter: drop-shadow(0 8px 22px rgba(0,0,0,.16)) brightness(1); }
    }

    /* 人物影子（贴地软阴影，随呼吸微变化） */
    .char-shadow {
      position: absolute; left: 50%; bottom: 14px; transform: translateX(-50%);
      width: 50%; height: 24px; border-radius: 50%;
      background: radial-gradient(closest-side, rgba(0,0,0,.22), rgba(0,0,0,0));
      filter: blur(16px);
      opacity: .72;
      z-index: 2;
      animation: shadowPulse 4.6s ease-in-out infinite;
    }
    @keyframes shadowPulse {
      0%   { transform: translateX(-50%) scaleX(1.00); opacity: .72; }
      25%  { transform: translateX(-50%) scaleX(1.04); opacity: .78; }
      50%  { transform: translateX(-50%) scaleX(1.00); opacity: .72; }
      75%  { transform: translateX(-50%) scaleX(0.96); opacity: .66; }
      100% { transform: translateX(-50%) scaleX(1.00); opacity: .72; }
    }

    /* 入场扫光 & 地影 */
    .entry-glow { position: absolute; inset: -20% -10%; background: conic-gradient(from 220deg at 50% 50%, rgba(47,92,255,.0), rgba(47,92,255,.25), rgba(230,62,109,.22), rgba(255,255,255,0)); mix-blend-mode: screen; filter: blur(18px); opacity: 0; pointer-events: none; z-index: 5; }
    .entry-glow.show { animation: glowSweep .9s ease-out forwards; }
    @keyframes glowSweep {
      0% { transform: translateX(-12%) rotate(-6deg); opacity: 0; }
      30% { opacity: .75; }
      100% { transform: translateX(12%) rotate(6deg); opacity: 0; }
    }
    .ground-shadow { position: absolute; left: 50%; bottom: 10px; transform: translateX(-50%); width: 46%; height: 22px; border-radius: 50%; background: radial-gradient(closest-side, rgba(0,0,0,.18), rgba(0,0,0,0)); filter: blur(14px); opacity: .0; pointer-events: none; z-index: 2; }
    .ground-shadow.show { animation: groundIn .9s ease-out forwards; }
    @keyframes groundIn {
      0%   { transform: translateX(-50%) scaleX(.6); opacity: 0; }
      60%  { transform: translateX(-50%) scaleX(1.08); opacity: .9; }
      100% { transform: translateX(-50%) scaleX(1); opacity: .7; }
    }

    /* 受击反馈 */
    .bossFrame-hit { animation: bossHit .25s ease; }
    @keyframes bossHit {
      0% { transform: translate(0,0); }
      25% { transform: translate(-2px, 1px); }
      50% { transform: translate(2px, -1px); }
      75% { transform: translate(-1px, 1px); }
      100% { transform: translate(0,0); }
    }
    .bossHit-flash::after {
      content: ""; position: absolute; inset: 0; z-index: 6;
      background: radial-gradient(circle at 50% 50%, rgba(255,255,255,.65), rgba(255,255,255,0) 55%);
      mix-blend-mode: screen; opacity: 0; animation: hitFlashWhite .18s ease;
      pointer-events: none;
    }
    @keyframes hitFlashWhite { 0% { opacity: .95; } 100% { opacity: 0; } }

    /* 击败效果 */
    .boss.defeated { animation: bossShake .5s ease-in-out both; }
    .boss-frame.defeated .boss-char img { opacity: 0; }
    .kill-wave { position: absolute; inset: 0; margin: auto; pointer-events: none; border-radius: 50%; background: radial-gradient(closest-side, rgba(255,80,110,.35), rgba(255,80,110,.22) 45%, rgba(255,80,110,0) 70%); transform: scale(0.2); opacity: 0; animation: waveOut .6s ease-out forwards; z-index: 6; }
    @keyframes waveOut { 0% { transform: scale(0.2); opacity: .0; } 20% { opacity: .95; } 100% { transform: scale(2.2); opacity: 0; } }
    @keyframes bossShake { 0% { transform: translate(0,0) rotate(0); } 20% { transform: translate(-2px, 2px) rotate(-0.6deg); } 40% { transform: translate(2px, -2px) rotate(0.6deg); } 60% { transform: translate(-1px, 1px) rotate(-0.4deg); } 80% { transform: translate(1px, -1px) rotate(0.4deg); } 100% { transform: translate(0,0) rotate(0); } }

    .particles { position: absolute; inset: 0; pointer-events: none; z-index: 6; }
    .particles span { position: absolute; width: 6px; height: 6px; border-radius: 50%; background: radial-gradient(circle, #ff7b9a, #e63e6d 60%, rgba(230,62,109,0)); box-shadow: 0 0 8px rgba(230,62,109,.55); opacity: 0; transform: translate(0,0) scale(.8); animation: particleOut .7s cubic-bezier(.2,.8,.2,1) forwards; }
    @keyframes particleOut { 0% { opacity: 0; transform: translate(0,0) scale(.8); } 10% { opacity: 1; } 100% { opacity: 0; transform: translate(var(--dx), var(--dy)) scale(0.2); } }

    .smoke { position: absolute; inset: 15% 10% 20%; z-index: 5; pointer-events: none; background: radial-gradient(60% 60% at 50% 50%, rgba(180,180,195,.28), rgba(200,200,210,.18) 60%, rgba(200,200,210,0)); filter: blur(18px); opacity: 0; animation: smokeOut .9s ease-out forwards; }
    @keyframes smokeOut { 0% { opacity: 0; transform: scale(.9); } 30% { opacity: .7; } 100% { opacity: 0; transform: scale(1.2); } }

    /* HP 与按钮保持 */
    .hp-row { display: grid; grid-template-columns: repeat(5, 1fr); gap: 14px; margin-top: 16px; }
    .hp { background: #ffffff; border: 1px solid var(--border); border-radius: 12px; width: 128px; height: 128px; max-width: 100%; display: grid; place-items: center; position: relative; overflow: hidden; margin-inline: auto; }
    .hp img { width: 100%; height: 100%; object-fit: contain; transition: transform .25s ease; padding: 8px; }
    .hp.alive:hover img { transform: scale(1.06); }
    .hp.destroying { animation: hitFlash .12s ease-in-out 2; }
    @keyframes hitFlash { 0%, 100% { filter: none; } 50% { filter: brightness(1.25) saturate(1.15); } }
    .hp.destroying img { animation: shatter .42s cubic-bezier(.2,.7,.2,1) forwards; transform-origin: 60% 40%; }
    @keyframes shatter { 0% { transform: scale(1) rotate(0deg); opacity: 1; filter: none; } 30% { transform: scale(1.08) rotate(-5deg); } 60% { transform: scale(0.9) rotate(8deg) translate(6px, -6px); filter: saturate(1.15); } 100% { transform: scale(0.6) rotate(16deg) translate(14px, -18px); opacity: 0; filter: blur(1px); } }
    .hp.dead { opacity: .22; filter: grayscale(1) contrast(.9); }

    .controls { display: flex; align-items: center; gap: 14px; margin-top: 18px; flex-wrap: wrap; }
    .btn { --btn-bg: linear-gradient(180deg, #2f5cff, #2144d9); --btn-br: #3b68ff; --btn-txt: #ffffff; appearance: none; border: 1px solid var(--btn-br); background: var(--btn-bg); color: var(--btn-txt); padding: 13px 18px; border-radius: 12px; font-weight: 800; letter-spacing: .4px; font-size: 16px; cursor: pointer; user-select: none; transform: translateZ(0); box-shadow: inset 0 1px 0 rgba(255,255,255,.08), 0 12px 22px rgba(0,0,0,.10); transition: transform .12s ease, filter .2s ease, box-shadow .2s ease; display: inline-flex; align-items: center; gap: 10px; }
    .btn:hover { transform: translateY(-1px) scale(1.01); filter: brightness(1.06) saturate(1.03); }
    .btn:active { transform: translateY(0) scale(.99); filter: brightness(.96); }
    .btn[disabled] { cursor: not-allowed; filter: grayscale(.4) brightness(.94); }
    .btn-danger  { --btn-bg: linear-gradient(180deg, #ff5c8a, #d83a63); --btn-br: #ff6f9a; }
    .btn-ghost { --btn-bg: linear-gradient(180deg, #f3f5ff, #eef1ff); --btn-br: #dfe4ff; --btn-txt: #2b3170; color: #2b3170; }

    .icon { width: 18px; height: 18px; position: relative; display: inline-block; }
    .icon-play::before, .icon-pause::before, .icon-pause::after { content: ""; position: absolute; inset: 0; margin: auto; transition: transform .25s ease, opacity .2s ease; }
    .icon-play::before { width: 0; height: 0; border-top: 8px solid transparent; border-bottom: 8px solid transparent; border-left: 12px solid currentColor; transform: translateX(2px); }
    .icon-pause::before, .icon-pause::after { width: 4px; height: 14px; background: currentColor; top: 2px; }
    .icon-pause::before { left: 3px; } .icon-pause::after { right: 3px; }

    .flash { animation: flash .5s ease; }
    @keyframes flash { 0% { filter: brightness(1.15) saturate(1.05); } 100% { filter: none; } }

    @media (max-width: 980px) {
      .title { font-size: 24px; }
      .sub { font-size: 14px; }
      .boss-frame { width: 100%; height: auto; }
      .hp { width: 100%; height: auto; aspect-ratio: 1 / 1; }
    }
  </style>
</head>
<body>
  <main class="card">
    <div class="header">
      <div>
        <div class="title">clubs A</div>
        <div class="sub">敌人阶段：额外进行一次攻击</div>
      </div>
      <span class="pill" id="hpCounter">HP 5 / 5</span>
    </div>

    <section class="boss-wrap">
      <div class="boss" id="boss">
        <div class="banner" id="banner">clubs_A 被击败！</div>

        <div class="boss-frame entering" id="bossFrame">
          <div class="name-chip">clubs A</div>

          <!-- 背景层（无呼吸效果） -->
          <div class="boss-bg">
            <img src="assets/boss_bg.png" alt="背景">
          </div>

          <!-- 人物层（呼吸 + 投影） -->
          <div class="boss-char">
            <img id="bossCharImg" src="assets/boss_char.png" alt="人物">
          </div>
          <div class="char-shadow"></div>

          <!-- 入场扫光与地影 -->
          <div class="entry-glow" id="entryGlow"></div>
          <div class="ground-shadow" id="groundShadow"></div>

          <!-- 粒子容器 -->
          <div class="particles" id="particles"></div>
        </div>
      </div>

      <!-- 5 个 128x128 血量图 -->
      <div class="hp-row" id="hpRow">
        <div class="hp alive"><img src="assets/hp1.png" alt="HP 1"></div>
        <div class="hp alive"><img src="assets/hp2.png" alt="HP 2"></div>
        <div class="hp alive"><img src="assets/hp3.png" alt="HP 3"></div>
        <div class="hp alive"><img src="assets/hp4.png" alt="HP 4"></div>
        <div class="hp alive"><img src="assets/hp5.png" alt="HP 5"></div>
      </div>

      <!-- 控制按钮 -->
      <div class="controls">
        <button class="btn btn-danger" id="attackBtn">攻击</button>
        <button class="btn" id="resetBtn" title="重置血量">重置</button>

        <button class="btn btn-ghost" id="musicBtn">
          <span class="icon icon-play" id="musicIcon" aria-hidden="true"></span>
          <span id="musicText">播放音乐</span>
        </button>
        <button class="btn btn-ghost" id="sfxBtn" title="开关音效">音效 开</button>

        <audio id="bgm" src="assets/demo.mp3" preload="auto" loop></audio>
        <audio id="sfxHit" src="assets/hit.mp3" preload="auto"></audio>
        <audio id="sfxDefeat" src="assets/defeat.mp3" preload="auto"></audio>
      </div>
    </section>
  </main>

  <script>
    // 元素
    const hpRow = document.getElementById('hpRow');
    const attackBtn = document.getElementById('attackBtn');
    const resetBtn = document.getElementById('resetBtn');
    const musicBtn = document.getElementById('musicBtn');
    const musicIcon = document.getElementById('musicIcon');
    const musicText = document.getElementById('musicText');
    const hpCounter = document.getElementById('hpCounter');
    const bgm = document.getElementById('bgm');

    const sfxBtn = document.getElementById('sfxBtn');
    const sfxHit = document.getElementById('sfxHit');
    const sfxDefeat = document.getElementById('sfxDefeat');

    const boss = document.getElementById('boss');
    const bossFrame = document.getElementById('bossFrame');
    const banner = document.getElementById('banner');
    const entryGlow = document.getElementById('entryGlow');
    const groundShadow = document.getElementById('groundShadow');
    const particles = document.getElementById('particles');

    let currentHP = 5;
    const maxHP = 5;
    let isPlaying = false;
    let sfxOn = true;

    function updateHpCounter() {
      hpCounter.textContent = `HP ${currentHP} / ${maxHP}`;
      hpCounter.classList.remove('flash');
      requestAnimationFrame(() => hpCounter.classList.add('flash'));
    }

    function playEntryAnimation() {
      entryGlow.classList.add('show');
      groundShadow.classList.add('show');
      requestAnimationFrame(() => {
        setTimeout(() => bossFrame.classList.remove('entering'), 950);
      });
    }

    function vibrate(pattern) {
      if (navigator.vibrate) { try { navigator.vibrate(pattern); } catch(e) {} }
    }

    function bossHitFeedback() {
      bossFrame.classList.remove('bossFrame-hit');
      void bossFrame.offsetWidth;
      bossFrame.classList.add('bossFrame-hit');

      bossFrame.classList.add('bossHit-flash');
      setTimeout(() => bossFrame.classList.remove('bossHit-flash'), 180);

      if (sfxOn) { try { sfxHit.currentTime = 0; sfxHit.play(); } catch(e) {} }
      vibrate(20);
    }

    function spawnDefeatParticles(count = 30) {
      const rect = bossFrame.getBoundingClientRect();
      const cx = rect.width / 2;
      const cy = rect.height / 2;
      for (let i = 0; i < count; i++) {
        const p = document.createElement('span');
        const angle = Math.random() * Math.PI * 2;
        const dist = 80 + Math.random() * 220;
        const dx = Math.cos(angle) * dist;
        const dy = Math.sin(angle) * dist * 0.8;
        p.style.left = cx + 'px';
        p.style.top = cy + 'px';
        p.style.setProperty('--dx', dx + 'px');
        p.style.setProperty('--dy', dy + 'px');
        const size = 4 + Math.random() * 7;
        p.style.width = p.style.height = size + 'px';
        p.style.animationDuration = (0.55 + Math.random() * 0.35) + 's';
        particles.appendChild(p);
        p.addEventListener('animationend', () => p.remove(), { once: true });
      }
    }

    function triggerDefeatFX() {
      attackBtn.disabled = true;
      banner.classList.add('show');
      boss.classList.add('defeated');

      const wave = document.createElement('div');
      wave.className = 'kill-wave';
      bossFrame.appendChild(wave);
      wave.addEventListener('animationend', () => wave.remove(), { once: true });

      spawnDefeatParticles(34);
      const smoke = document.createElement('div');
      smoke.className = 'smoke';
      bossFrame.appendChild(smoke);
      smoke.addEventListener('animationend', () => smoke.remove(), { once: true });

      bossFrame.classList.add('defeated');

      vibrate([60, 40, 60]);
      if (sfxOn) { try { sfxDefeat.currentTime = 0; sfxDefeat.play(); } catch(e) {} }
    }

    function resetDefeatFX() {
      attackBtn.disabled = false;
      banner.classList.remove('show');
      boss.classList.remove('defeated');
      bossFrame.classList.remove('defeated');
    }

    function destroyOneHP() {
      const target = hpRow.querySelector('.hp.alive');
      if (!target) return;

      bossHitFeedback();

      target.classList.remove('alive');
      target.classList.add('destroying');
      target.addEventListener('animationend', (e) => {
        if (e.animationName === 'shatter') {
          target.classList.remove('destroying');
          target.classList.add('dead');
        }
      }, { once: true });

      currentHP = Math.max(0, currentHP - 1);
      updateHpCounter();

      if (currentHP <= 0) {
        triggerDefeatFX();
      }
    }

    function resetHP() {
      const all = hpRow.querySelectorAll('.hp');
      all.forEach(el => {
        el.classList.remove('dead', 'destroying');
        if (!el.classList.contains('alive')) el.classList.add('alive');
      });
      currentHP = maxHP;
      updateHpCounter();
      resetBtn.classList.remove('flash');
      requestAnimationFrame(() => resetBtn.classList.add('flash'));
      resetDefeatFX();
    }

    async function toggleMusic() {
      try {
        if (!isPlaying) {
          await bgm.play();
          isPlaying = true;
          musicIcon.classList.remove('icon-play');
          musicIcon.classList.add('icon-pause');
          musicText.textContent = '暂停音乐';
        } else {
          bgm.pause();
          isPlaying = false;
          musicIcon.classList.remove('icon-pause');
          musicIcon.classList.add('icon-play');
          musicText.textContent = '播放音乐';
        }
        musicBtn.classList.remove('flash');
        requestAnimationFrame(() => musicBtn.classList.add('flash'));
      } catch (err) {
        console.warn('无法播放音乐：', err);
      }
    }

    function toggleSfx() {
      sfxOn = !sfxOn;
      sfxBtn.textContent = sfxOn ? '音效 开' : '音效 关';
      vibrate(10);
    }

    // 事件
    attackBtn.addEventListener('click', destroyOneHP);
    resetBtn.addEventListener('click', resetHP);
    musicBtn.addEventListener('click', toggleMusic);
    sfxBtn.addEventListener('click', toggleSfx);

    // 初始化
    updateHpCounter();
    if (document.readyState === 'complete') {
      playEntryAnimation();
    } else {
      window.addEventListener('load', playEntryAnimation, { once: true });
    }
  </script>
</body>
</html>